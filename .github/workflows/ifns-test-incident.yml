name: IFNS Test Incident (Create & Notify)

on:
  workflow_dispatch:
    inputs:
      title:
        description: "Incident title"
        required: true
      severity:
        description: "Incident severity"
        required: true
      incident_type:
        description: "Incident type"
        required: true
      summary:
        description: "Incident summary"
        required: true

jobs:
  create-and-notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install deps
        run: pip install requests python-dateutil
      - name: Create Test Incident in Notion
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          ROOT_PAGE_ID: ${{ secrets.ROOT_PAGE_ID }}
          NOTION_INCIDENT_LOG_DB_ID: ${{ secrets.NOTION_INCIDENT_LOG_DB_ID }}
          NOTION_SNAPSHOT_RUN_LOG_DB_ID: ${{ secrets.NOTION_SNAPSHOT_RUN_LOG_DB_ID }}
          NOTION_NARRATIVE_AI_LOG_DB_ID: ${{ secrets.NOTION_NARRATIVE_AI_LOG_DB_ID }}
        run: |
          python scripts/create_test_incident.py \
            --title "${{ github.event.inputs.title }}" \
            --severity "${{ github.event.inputs.severity }}" \
            --type "${{ github.event.inputs.incident_type }}" \
            --summary "${{ github.event.inputs.summary }}"
